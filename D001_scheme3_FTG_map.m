%% Load the ESP-FTG mapping relationships
fileName = "/projectnb/amazondr/data10/cliveg/zpzuo/paper2_intermediate_data/ESP-FTG_mapping.xlsx";
sheetNames = sheetnames(fileName);
fgrp_esp = struct();
for k = 1:numel(sheetNames)
    fgrp_esp.("fgrp"+sheetNames{k}) = table2array(readtable(fileName, "Sheet", sheetNames(k), "Range", "A:A"));
end
%% Load the ESP map
[esp, R] = readgeoraster("/projectnb/amazondr/data10/cliveg/zpzuo/paper2_intermediate_data/ESP_v140_byLandfire_250m.tif");
%% Construct the potential FTG map
pFTG = 100 * ismember(esp, getfield(fgrp_esp, "fgrp"+100)) + ...
    120 * ismember(esp, getfield(fgrp_esp, "fgrp"+120)) + ...
    140 * ismember(esp, getfield(fgrp_esp, "fgrp"+140)) + ...
    160 * ismember(esp, getfield(fgrp_esp, "fgrp"+160)) + ...
    400 * ismember(esp, getfield(fgrp_esp, "fgrp"+400)) + ...
    500 * ismember(esp, getfield(fgrp_esp, "fgrp"+500)) + ...
    600 * ismember(esp, getfield(fgrp_esp, "fgrp"+600)) + ...
    800 * ismember(esp, getfield(fgrp_esp, "fgrp"+800)) + ...
    900 * ismember(esp, getfield(fgrp_esp, "fgrp"+900));
%% Save the potential FTG map
geotiffwrite("/projectnb/amazondr/data10/cliveg/zpzuo/paper2_intermediate_data/" + "PotentialFTG_byESP_250m", ...
    pFTG, ...
    R, "CoordRefSysCode", "EPSG:5070", ...
    "TiffTags", struct("Compression", "LZW"))
%%
%test = ismember(esp, [13711:13713, 13894:13903, 14131, 14395:14404]); % Northeastern Interior Pine Barrens
%test = ismember(esp, [12681:12687, 12849:12856, 13004:13008, 13154:13157, 13455:13460, 19242:19248]); % Southern Appalachian Montane Pine Forest and Woodland
%imshow(test)